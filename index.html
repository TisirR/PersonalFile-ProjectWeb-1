<!DOCTYPE html>
<!-- saved from url=(0051)file:///C:/Users/q8972/Desktop/SelfwebTexting2.html -->
<html lang="zh-CN"><head>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// ä½¿ç”¨æ‚¨çš„é…ç½®ä¿¡æ¯
const SUPABASE_URL = 'https://hjtxgmlzqmasdgzjpvja.supabase.co';
const SUPABASE_ANON_KEY = 'sb_publishable_n5Fv_PIfuEKm2CnmFZEBOA_AYs1IOJA';

// åˆå§‹åŒ– Supabase å®¢æˆ·ç«¯
try {
    // æ£€æŸ¥ supabase åº“æ˜¯å¦å·²åŠ è½½
    if (typeof supabase === 'undefined') {
        throw new Error('Supabase JS åº“æœªåŠ è½½æˆåŠŸ');
    }
    // åˆ›å»ºå®¢æˆ·ç«¯å¹¶èµ‹ç»™å…¨å±€å˜é‡
    window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    console.log('âœ… Supabase å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ');
} catch (error) {
    console.error('âŒ Supabase åˆå§‹åŒ–å¤±è´¥:', error);
    // è®¾ç½®ä¸€ä¸ªç©ºçš„å®¢æˆ·ç«¯ï¼Œä»¥ä¾¿åç»­ä»£ç ä¸ä¼šå› ä¸ºwindow.supabaseæœªå®šä¹‰è€ŒæŠ¥é”™
    window.supabase = null;
}
</script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RB/Tisir_Rçš„ä¸ªäººç½‘é¡µVer.4.8.3(æ”¹è¿›ä¸­)</title>
    
        <!-- ç½‘ç«™å¤´åƒ -->
    <link rel="apple-touch-icon" sizes="57x57" href="https://raw.githubusercontent.com/TisirR/PersonalFile-ProjectWeb-1/favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://raw.githubusercontent.com/TisirR/PersonalFile-ProjectWeb-1/favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://raw.githubusercontent.com/TisirR/PersonalFile-ProjectWeb-1/favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://raw.githubusercontent.com/TisirR/PersonalFile-ProjectWeb-1/favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://raw.githubusercontent.com/TisirR/PersonalFile-ProjectWeb-1/favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://raw.githubusercontent.com/TisirR/PersonalFile-ProjectWeb-1/favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://raw.githubusercontent.com/TisirR/PersonalFile-ProjectWeb-1/favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://raw.githubusercontent.com/TisirR/PersonalFile-ProjectWeb-1/favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/TisirR/PersonalFile-ProjectWeb-1/favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="https://raw.githubusercontent.com/TisirR/PersonalFile-ProjectWeb-1/favicons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/TisirR/PersonalFile-ProjectWeb-1/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="https://raw.githubusercontent.com/TisirR/PersonalFile-ProjectWeb-1/favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://raw.githubusercontent.com/TisirR/PersonalFile-ProjectWeb-1/favicons/favicon-16x16.png">
    <link rel="manifest" href="https://raw.githubusercontent.com/TisirR/PersonalFile-ProjectWeb-1/favicons/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="https://raw.githubusercontent.com/TisirR/PersonalFile-ProjectWeb-1/favicons/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
        
    <style>

        .visitor-counter {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            color: #666;
            font-size: 0.9em;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            display: inline-block;
            position: fixed;
            bottom: 20px;
            right: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-radius: 10px;
            /* æ·»åŠ ç§»åŠ¨ç«¯é€‚é… */
            width: 100%;
            box-sizing: border-box;
        }
        
        /* é˜²æ­¢æ–‡å­—æº¢å‡º */
        .section p, .section div, #displayContact p {
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
        }
        
        header {
            text-align: center;
            padding: 40px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            margin-bottom: 30px;
            position: relative;
        }
        
        .avatar-container {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 5px solid white;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .avatar:hover {
            transform: scale(1.05);
        }
        
        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .avatar-edit-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.3s ease;
            cursor: pointer;
        }
        
        .avatar-container:hover .avatar-edit-overlay {
            opacity: 1;
        }
        
        h1 {
            margin: 0 0 10px;
            font-size: 2.5em;
        }
        
        .tagline {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .section {
            margin: 30px 0;
            padding: 25px;
            border-left: 4px solid #667eea;
            background: #f9f9f9;
            border-radius: 0 8px 8px 0;
        }
        
        h2 {
            color: #667eea;
            margin-top: 0;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        
        .skills {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .skill {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            transition: transform 0.3s;
        }
        
        .skill:hover {
            transform: translateY(-3px);
        }
        
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            border-top: 1px solid #eee;
            color: #666;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh; /* é™åˆ¶æœ€å¤§é«˜åº¦ */
            overflow-y: auto; /* æ·»åŠ æ»šåŠ¨æ¡ */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, textarea {
            width: calc(100% - 22px); /* è€ƒè™‘paddingå’Œborder */
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
            box-sizing: border-box; /* é‡è¦ï¼šåŒ…å«paddingå’Œborderåœ¨å®½åº¦å†… */
        }

        .btn-block {
            display: block;
            width: 100%;
            box-sizing: border-box; /* ç¡®ä¿æŒ‰é’®å®½åº¦è®¡ç®—ä¸€è‡´ */
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #5a6fd8;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .avatar-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin: 10px auto;
            display: block;
            border: 2px solid #667eea;
        }
        
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }
        
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-btn {
            display: block;
            padding: 10px;
            background: #f8f9fa;
            border: 1px dashed #667eea;
            border-radius: 5px;
            text-align: center;
            color: #667eea;
            cursor: pointer;
        }
        
        .status-message {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            display: none;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .project-input-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
            position: relative;
        }
        
        .project-input-group:first-child .remove-project {
            display: none !important;
        }
        
        @media (max-width: 600px) {
            .container {
                margin: 10px;
                padding: 15px;
                width: calc(100% - 20px); /* æ–°å¢ï¼šç¡®ä¿ä¸è¶…å‡ºå±å¹• */
            }
            
            header {
                padding: 20px 0;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .avatar {
                width: 120px;
                height: 120px;
            }
            
            /* æ–°å¢ï¼šé˜²æ­¢æ–‡å­—æº¢å‡º */
            .section p, .section div, #displayContact p {
                word-wrap: break-word;
                overflow-wrap: break-word;
                white-space: normal;
                word-break: break-word;
                max-width: 100%;
            }
            
            /* æ–°å¢ï¼šä¿®å¤æŠ€èƒ½æ ‡ç­¾æ¢è¡Œ */
            .skills {
                gap: 5px;
            }
            
            .skill {
                font-size: 12px;
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="avatar-container">
                <div class="avatar" id="avatarDisplay"><img src="" alt="ä¸ªäººå¤´åƒ"></div>
                <div class="avatar-edit-overlay" onclick="openPasswordModal('avatar')">
                    <span>ä¿®æ”¹å¤´åƒ</span>
                </div>
            </div>
            <h1 id="displayName">RB/Tisir_R</h1>
            <p class="tagline" id="displayTagline">ä¸ªç­¾</p>
        </header>
        
        <section class="section">
            <h2>å…³äºæˆ‘</h2>
            <p id="displayAbout">ç®€ä»‹.txt</p>
        </section>
        
        <section class="section">
            <h2>æ•™è‚²èƒŒæ™¯</h2>
            <p id="displayEducation"><strong>è¿™æ˜¯å¤§å­¦</strong> - æˆ‘çš„ä¸“ä¸š (2025-2029)</p>
        </section>
        
        <section class="section">
            <h2>æˆ‘çš„æŠ€èƒ½</h2>
            <div class="skills" id="displaySkills"><div class="skill">æš‚æ— </div></div>
        </section>
        
        <section class="section">
            <h2>å…¶ä»–ä¿¡æ¯</h2>
            <div id="displayProjects">
                <div style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px; box-shadow: rgba(0, 0, 0, 0.1) 0px 2px 5px;">
                    <h3 style="margin-top: 0; color: #667eea;">ä¸»è¦æ´»è·ƒå¹³å°</h3>
                    <p style="margin-bottom: 0;">å¹³å°</p>
                </div></div>
        </section>
        
        <section class="section">
            <h2>è”ç³»æ–¹å¼</h2>
            <div id="displayContact"><p>ğŸ“§ é‚®ç®±ï¼šexample@email.com</div>
        </section>
        
        <section class="section">
            <h2>ç½‘ç«™è®¾ç½®</h2>
            <p>ä½ å¯ä»¥éšæ—¶ä¿®æ”¹ç½‘ç«™å†…å®¹ï¼Œæ‰€æœ‰æ›´æ”¹ä¼šè‡ªåŠ¨ä¿å­˜ã€‚</p >
            <button class="btn" onclick="openPasswordModal('edit')">ç¼–è¾‘å…¨éƒ¨å†…å®¹</button>
        </section>

        <!-- åé¦ˆç®¡ç†æ¨¡å— -->
        <section class="section">
            <h2>åé¦ˆç®¡ç†</h2>
            
            <!-- åé¦ˆç»Ÿè®¡ -->
            <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                <div class="feedback-stat" style="background: #e3f2fd; padding: 15px; border-radius: 8px; min-width: 120px;">
                    <div style="font-size: 0.9em; color: #1976d2;">å¾…å¤„ç†åé¦ˆ</div>
                    <div id="pendingCount" style="font-size: 1.5em; font-weight: bold; color: #1976d2;">0</div>
                </div>
                <div class="feedback-stat" style="background: #e8f5e8; padding: 15px; border-radius: 8px; min-width: 120px;">
                    <div style="font-size: 0.9em; color: #2e7d32;">å·²å¤„ç†åé¦ˆ</div>
                    <div id="processedCount" style="font-size: 1.5em; font-weight: bold; color: #2e7d32;">0</div>
                </div>
                <div class="feedback-stat" style="background: #f3e5f5; padding: 15px; border-radius: 8px; min-width: 120px;">
                    <div style="font-size: 0.9em; color: #7b1fa2;">æ€»åé¦ˆæ•°</div>
                    <div id="totalCount" style="font-size: 1.5em; font-weight: bold; color: #7b1fa2;">0</div>
                </div>
            </div>
            
            <!-- åé¦ˆåˆ—è¡¨ -->
            <div id="feedbackList" style="max-height: 400px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; background: #fafafa;">
                <p style="text-align: center; color: #666;">åŠ è½½åé¦ˆä¸­...</p >
            </div>
            
            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <button class="btn" onclick="loadFeedback()">åˆ·æ–°åé¦ˆåˆ—è¡¨</button>
                <button class="btn btn-secondary" onclick="showOnlyPending()">åªçœ‹å¾…å¤„ç†</button>
                <button class="btn btn-secondary" onclick="showAllFeedback()">æ˜¾ç¤ºå…¨éƒ¨</button>
            </div>
        </section>

        <section class="section">
            <h2>åé¦ˆä¸å»ºè®®</h2>
            <p>æ¬¢è¿æå‡ºå®è´µæ„è§ï¼Œå¸®åŠ©æˆ‘æ”¹è¿›ç½‘ç«™ï¼</p >
            
            <div class="form-group">
                <label>æ‚¨çš„ç§°å‘¼ (å¯é€‰):</label>
                <input type="text" id="feedbackName" placeholder="æ€ä¹ˆç§°å‘¼æ‚¨ï¼Ÿ" style="width: 100%;">
            </div>
            
            <div class="form-group">
                <label>é‚®ç®± (å¯é€‰ï¼Œç”¨äºå›å¤):</label>
                <input type="email" id="feedbackEmail" placeholder="æ‚¨çš„é‚®ç®±åœ°å€" style="width: 100%;">
            </div>
            
            <div class="form-group">
                <label>åé¦ˆå†…å®¹:</label>
                <textarea id="feedbackMessage" placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„å»ºè®®æˆ–é‡åˆ°çš„é—®é¢˜..." style="width: 100%; height: 120px;"></textarea>
            </div>
            
            <button class="btn" id="feedbackSubmitBtn" onclick="submitFeedback()">æäº¤åé¦ˆ</button>
            
            <div id="feedbackStatus" class="status-message" style="display: none;"></div>
        </section>
        
        <footer>
            <p>Â© 2025 æˆ‘çš„ä¸ªäººç½‘é¡µ | æœ€åæ›´æ–°: <span id="last_updated">2025/11/28</span></p>
        </footer>
    </div>

    <!-- å¤´åƒç¼–è¾‘æ¨¡æ€æ¡† -->
    <div id="avatarModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ä¿®æ”¹å¤´åƒ</h3>
                <button class="close-btn" onclick="closeAvatarModal()">Ã—</button>
            </div>
            <div class="form-group">
                <label>é€‰æ‹©æ–°å¤´åƒ:</label>
                <div class="file-input-wrapper">
                    <div class="file-input-btn">ç‚¹å‡»é€‰æ‹©å›¾ç‰‡æ–‡ä»¶</div>
                    <input type="file" id="avatarUpload" accept="image/*">
                </div>
            </div>
            <div class="form-group">
                <label>å¤´åƒé¢„è§ˆ:</label>
                <img id="avatarPreview" class="avatar-preview" src="" alt="å¤´åƒé¢„è§ˆ">
            </div>
            <div id="avatarStatus" class="status-message"></div>
            <button class="btn btn-block" onclick="uploadAvatar()">æ›´æ–°å¤´åƒ</button>
        </div>
    </div>

    <!-- å¯†ç éªŒè¯æ¨¡æ€æ¡† -->
    <div id="passwordModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 350px;">
            <div class="modal-header">
                <h3>è¯·è¾“å…¥ç¼–è¾‘å¯†ç </h3>
                <button class="close-btn" onclick="closePasswordModal()">&times;</button>
            </div>
            <div class="form-group">
                <label>å¯†ç :</label>
                <input type="password" id="passwordInput" placeholder="è¯·è¾“å…¥å¯†ç ">
            </div>
            <div id="passwordStatus" class="status-message"></div>
            <button class="btn btn-block" onclick="verifyPassword()">ç¡®è®¤</button>
        </div>
    </div>

    <!-- å†…å®¹ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div id="editModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ç¼–è¾‘ç½‘ç«™å†…å®¹</h3>
                <button class="close-btn" onclick="closeEditModal()">Ã—</button>
            </div>
            <div class="form-group">
                <label>å§“å:</label>
                <input type="text" id="editName" placeholder="ä½ çš„å§“å">
            </div>
            <div class="form-group">
                <label>ä¸ªç­¾:</label>
                <input type="text" id="editTagline" placeholder="å±•ç°ä½ çš„ä¸ªæ€§ç­¾å">
            </div>
            <div class="form-group">
                <label>å…³äºæˆ‘:</label>
                <textarea id="editAbout" placeholder="ä»‹ç»ä½ çš„ä¸ªäººä¿¡æ¯" style="height: 30px;"></textarea>
            </div>
            <div class="form-group">
                <label>æ•™è‚²èƒŒæ™¯:</label>
                <textarea id="editEducation" placeholder="æ•™è‚²èƒŒæ™¯ä¿¡æ¯" style="height: 40px;"></textarea>
            </div>
            <div class="form-group">
                <label>æŠ€èƒ½ (ç”¨é€—å·åˆ†éš”):</label>
                <input type="text" id="editSkills" placeholder="ä¾‹å¦‚: HTML, CSS, JavaScript">
            </div>
            <div class="form-group">
                <label>å…¶ä»–ä¿¡æ¯:</label>
                <div id="projectsContainer">
                    <!-- é¡¹ç›®è¾“å…¥æ¡†å°†åŠ¨æ€æ·»åŠ åœ¨è¿™é‡Œ -->
                    <div class="project-input-group">
                        <input type="text" class="project-title" placeholder="æ ‡é¢˜ (ä¾‹å¦‚: ä¸»è¦æ´»è·ƒå¹³å°)" style="margin-bottom: 8px; width: 100%; box-sizing: border-box;">
                        <textarea class="project-description" placeholder="å†…å®¹æè¿° (æ”¯æŒæ¢è¡Œ)" style="height: 60px; margin-bottom: 10px; width: 100%; box-sizing: border-box; resize: vertical;"></textarea>
                        <button type="button" class="btn btn-secondary remove-project" style="display: none; padding: 5px 10px; font-size: 12px;">åˆ é™¤</button>
                    </div>
                </div>
                <button type="button" class="btn btn-secondary" onclick="addProjectInput()" style="margin-top: 10px;">
                    + æ·»åŠ æ–°é¡¹ç›®
                </button>
            </div>
            <div class="form-group">
                <label>é¡µé¢æ ‡é¢˜è®¾ç½®:</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div>
                        <label style="font-size: 0.9em; color: #666;">æ­£å¸¸æ ‡é¢˜</label>
                        <input type="text" id="editActiveTitle" placeholder="ç”¨æˆ·åœ¨å½“å‰é¡µé¢æ—¶æ˜¾ç¤º">
                    </div>
                    <div>
                        <label style="font-size: 0.9em; color: #666;">ä¼‘çœ æ ‡é¢˜</label>
                        <input type="text" id="editInactiveTitle" placeholder="ç”¨æˆ·ç¦»å¼€é¡µé¢æ—¶æ˜¾ç¤º">
                    </div>
                </div>
                <p style="font-size: 0.8em; color: #888; margin-top: 5px;">
                    å½“ç”¨æˆ·åˆ‡æ¢åˆ°å…¶ä»–æ ‡ç­¾é¡µæ—¶ï¼Œæ ‡é¢˜ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸º"ä¼‘çœ æ ‡é¢˜"
                </p >
            </div>
            <div class="form-group">
                <label>è”ç³»æ–¹å¼ (æ¯è¡Œä¸€ä¸ª):</label>
                <textarea id="editContact" placeholder="ä¾‹å¦‚: é‚®ç®±: example@email.com" style="height: -6px;"></textarea>
            </div>
            <div id="editStatus" class="status-message status-success" style="display: none;">æ‰€æœ‰æ›´æ”¹å·²ä¿å­˜!</div>
            <button class="btn btn-block" onclick="saveChanges()">ä¿å­˜æ‰€æœ‰æ›´æ”¹</button>
        </div>
    </div>

    <script>

        // å¯†ç è®¾ç½®
        const EDIT_PASSWORD = "q8972111"; // ä½ å¯ä»¥ä¿®æ”¹è¿™ä¸ªå¯†ç 

        // é»˜è®¤æ•°æ®
        const defaultData = {
            name: "å§“å",
            tagline: "ä¸ªç­¾",
            about: "å…³äºæˆ‘",
            education: "æŸæŸå¤§å­¦ - ä¸“ä¸š (å¹´ä»½-å¹´ä»½)",
            skills: ["æŠ€èƒ½1", "æŠ€èƒ½2", "æŠ€èƒ½3", "æŠ€èƒ½4", "æŠ€èƒ½5",],
            projects: [
                { title: "å¹³å°1", description: "å†…å®¹1ã€‚" },
                { title: "å¹³å°2", description: "å†…å®¹2ã€‚" },
                { title: "å¹³å°3", description: "å†…å®¹3ã€‚" }
            ],
            contact: [
                "ğŸ“§ é‚®ç®±: example@email.com",
                "ğŸ“± å¾®ä¿¡: example",
                "ğŸ± GitHub: example-github"
            ],
            avatar: null, // åˆå§‹æ²¡æœ‰å¤´åƒï¼Œä½¿ç”¨é»˜è®¤
            // æ·»åŠ æ ‡é¢˜è®¾ç½®
            activeTitle: "Cialloï½(âˆ ãƒ»Ï‰< )âŒ’â˜…",
            inactiveTitle: "|Â´â€¢Ï‰â€¢`)â€¦",
            last_updated: new Date().toLocaleDateString('zh-CN')
        };

        // æ ‡é¢˜åˆ‡æ¢åŠŸèƒ½ - ä½¿ç”¨ç”¨æˆ·è®¾ç½®çš„æ ‡é¢˜
        let isTabActive = true;
        
        // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // é¡µé¢ä¸å¯è§ï¼ˆåˆ‡æ¢åˆ°å…¶ä»–æ ‡ç­¾é¡µæˆ–æœ€å°åŒ–ï¼‰
                const inactiveTitle = window.currentData?.inactiveTitle || "|Â´â€¢Ï‰â€¢`)â€¦";
                document.title = inactiveTitle;
                isTabActive = false;
            } else {
                // é¡µé¢å¯è§
                const activeTitle = window.currentData?.activeTitle || "Cialloï½(âˆ ãƒ»Ï‰< )âŒ’â˜…";
                document.title = activeTitle;
                isTabActive = true;
            }
        });
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateVisitorStats();
            loadFeedbackStats();
            document.getElementById('last_updated').textContent = new Date().toLocaleDateString('zh-CN');

            // ç›‘å¬å¯†ç è¾“å…¥æ¡†çš„Enteré”®
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    verifyPassword();
                }
            });
        });

        // ä»æ•°æ®åº“åŠ è½½æ•°æ® - ä¼˜åŒ–ç‰ˆ
        async function loadData() {
            try {
                console.log('æ­£åœ¨ä»SupabaseåŠ è½½æ•°æ®...');
                
                // ä»Supabaseè¯»å–æ•°æ®
                const { data, error } = await window.supabase
                    .from('website_data')
                    .select('*')
                    .eq('id', 1)
                    .single();
                    
                if (error) {
                    console.log('ä»æ•°æ®åº“åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®:', error);
                    // é™çº§åˆ°æœ¬åœ°å­˜å‚¨
                    const savedData = localStorage.getItem('personalWebsiteData');
                    const data = savedData ? JSON.parse(savedData) : defaultData;
                    updatePageWithData(data);
                    return;
                }
                
                if (data) {
                    console.log('ä»æ•°æ®åº“åŠ è½½æ•°æ®æˆåŠŸ');
                    updatePageWithData(data);
                    
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼ŒåŒ…å«å®Œæ•´çš„å¤´åƒæ•°æ®
                const dataForLocalStorage = { ...data };
                localStorage.setItem('personalWebsiteData', JSON.stringify(dataForLocalStorage));
                } else {
                    console.log('æ•°æ®åº“ä¸­æ²¡æœ‰æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
                    updatePageWithData(defaultData);
                }
            } catch (error) {
                console.log('åŠ è½½é”™è¯¯ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®:', error);
                const savedData = localStorage.getItem('personalWebsiteData');
                const data = savedData ? JSON.parse(savedData) : defaultData;
                updatePageWithData(data);
            }
        }

            // ä¼˜åŒ–çš„è®¿å®¢ç»Ÿè®¡ç³»ç»Ÿ
            async function updateVisitorStats() {
                try {
                    // æ£€æŸ¥ Supabase æ˜¯å¦å¯ç”¨
                    if (!window.supabase) {
                        throw new Error('Supabase ä¸å¯ç”¨');
                    }
            
                    // ç”Ÿæˆæˆ–è·å–è®¿å®¢ID
                    let visitorId = localStorage.getItem('visitor_id');
                    let isNewVisitor = false;
            
                    if (!visitorId) {
                        // æ–°è®¿å®¢ - ç”Ÿæˆå”¯ä¸€ID
                        visitorId = generateVisitorId();
                        localStorage.setItem('visitor_id', visitorId);
                        isNewVisitor = true;
                        console.log('æ–°è®¿å®¢:', visitorId);
                    } else {
                        console.log('å›è®¿è®¿å®¢:', visitorId);
                    }
            
                    // æ›´æ–°è®¿å®¢ä¼šè¯
                    await updateVisitorSession(visitorId);
            
                    // æ›´æ–°æ€»è®¿é—®æ¬¡æ•°å’Œç‹¬ç«‹è®¿å®¢æ•°
                    await updateVisitorCounts(isNewVisitor);
            
                    // æ›´æ–°é¡µé¢æ˜¾ç¤º
                    await loadVisitorStats();
            
                } catch (error) {
                    console.error('æ›´æ–°è®¿å®¢ç»Ÿè®¡å¤±è´¥:', error);
                    // é™çº§åˆ°æœ¬åœ°è®¡æ•°
                    fallbackToLocalStats();
                }
            }
            
            // ç”Ÿæˆå”¯ä¸€è®¿å®¢ID
            function generateVisitorId() {
                return 'visitor_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
            
            // æ›´æ–°è®¿å®¢ä¼šè¯
            async function updateVisitorSession(visitorId) {
                const { data, error } = await window.supabase
                    .from('visitor_sessions')
                    .select('*')
                    .eq('visitor_id', visitorId)
                    .single();
            
                if (error && error.code === 'PGRST116') {
                    // æ–°è®¿å®¢ - åˆ›å»ºä¼šè¯
                    const { error: insertError } = await window.supabase
                        .from('visitor_sessions')
                        .insert([
                            {
                                visitor_id: visitorId,
                                first_visit: new Date().toISOString(),
                                last_visit: new Date().toISOString(),
                                visit_count: 1
                            }
                        ]);
                    
                    if (insertError) throw insertError;
                } else if (data) {
                    // å›è®¿è®¿å®¢ - æ›´æ–°ä¼šè¯
                    const { error: updateError } = await window.supabase
                        .from('visitor_sessions')
                        .update({
                            last_visit: new Date().toISOString(),
                            visit_count: data.visit_count + 1
                        })
                        .eq('visitor_id', visitorId);
                    
                    if (updateError) throw updateError;
                } else if (error) {
                    throw error;
                }
            }
            
            // æ›´æ–°æ€»è®¿é—®æ¬¡æ•°å’Œç‹¬ç«‹è®¿å®¢æ•°
            async function updateVisitorCounts(isNewVisitor) {
                // è·å–å½“å‰ç»Ÿè®¡
                const { data: currentStats, error: fetchError } = await window.supabase
                    .from('visitor_stats')
                    .select('*')
                    .eq('id', 1)
                    .single();
            
                if (fetchError) throw fetchError;
            
                // æ›´æ–°ç»Ÿè®¡
                const updateData = {
                    total_visits: currentStats.total_visits + 1,
                    unique_visitors: currentStats.unique_visitors + (isNewVisitor ? 1 : 0),
                    updated_at: new Date().toISOString()
                };
            
                const { error: updateError } = await window.supabase
                    .from('visitor_stats')
                    .update(updateData)
                    .eq('id', 1);
            
                if (updateError) throw updateError;
            }
            
            // åŠ è½½å¹¶æ˜¾ç¤ºè®¿å®¢ç»Ÿè®¡
            async function loadVisitorStats() {
                try {
                    const { data, error } = await window.supabase
                        .from('visitor_stats')
                        .select('total_visits, unique_visitors')
                        .eq('id', 1)
                        .single();
            
                    if (error) throw error;
            
                    if (data) {
                        document.getElementById('totalVisits').textContent = data.total_visits;
                        document.getElementById('uniqueVisitors').textContent = data.unique_visitors;
                    }
                } catch (error) {
                    console.error('åŠ è½½è®¿å®¢ç»Ÿè®¡å¤±è´¥:', error);
                }
            }
            
            // å¤‡ç”¨æœ¬åœ°ç»Ÿè®¡
            function fallbackToLocalStats() {
                let totalVisits = parseInt(localStorage.getItem('localTotalVisits') || '0');
                let uniqueVisitors = parseInt(localStorage.getItem('localUniqueVisitors') || '0');
                
                totalVisits++;
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯æ–°è®¿å®¢
                let visitorId = localStorage.getItem('visitor_id');
                if (!visitorId) {
                    visitorId = generateVisitorId();
                    localStorage.setItem('visitor_id', visitorId);
                    uniqueVisitors++;
                }
                
                localStorage.setItem('localTotalVisits', totalVisits.toString());
                localStorage.setItem('localUniqueVisitors', uniqueVisitors.toString());
                
                document.getElementById('totalVisits').textContent = totalVisits;
                document.getElementById('uniqueVisitors').textContent = uniqueVisitors;
                
                console.log('ä½¿ç”¨æœ¬åœ°è®¿å®¢ç»Ÿè®¡:', { totalVisits, uniqueVisitors });
            }
        
            // æ·»åŠ æ–°çš„é¡¹ç›®è¾“å…¥æ¡†
            function addProjectInput() {
                const container = document.getElementById('projectsContainer');
                const newGroup = document.createElement('div');
                newGroup.className = 'project-input-group';
                
                newGroup.innerHTML = `
                    <input type="text" class="project-title" placeholder="æ ‡é¢˜ (ä¾‹å¦‚: ä¸»è¦æ´»è·ƒå¹³å°)" style="margin-bottom: 8px; width: 100%; box-sizing: border-box;">
                    <textarea class="project-description" placeholder="å†…å®¹æè¿° (æ”¯æŒæ¢è¡Œ)" style="height: 60px; margin-bottom: 10px; width: 100%; box-sizing: border-box; resize: vertical;"></textarea>
                    <button type="button" class="btn btn-secondary remove-project" onclick="removeProjectInput(this)" style="position: absolute; top: 10px; right: 10px; padding: 5px 10px; font-size: 12px;">åˆ é™¤</button>
                `;
                
                container.appendChild(newGroup);
            }
            
            // åˆ é™¤é¡¹ç›®è¾“å…¥æ¡†
            function removeProjectInput(button) {
                const group = button.closest('.project-input-group');
                if (group) {
                    group.remove();
                }
            }
            
                // ä»è¾“å…¥æ¡†æ”¶é›†é¡¹ç›®æ•°æ®
                function collectProjectsData() {
                    const projectGroups = document.querySelectorAll('.project-input-group'); // æ·»åŠ äº† document
                    const projects = [];
                
                projectGroups.forEach(group => {
                    const titleInput = group.querySelector('.project-title');
                    const descInput = group.querySelector('.project-description');
                    
                    const title = titleInput ? titleInput.value.trim() : '';
                    const description = descInput ? descInput.value.trim() : '';
                    
                    if (title || description) {
                        projects.push({
                            title: title || 'æœªå‘½åé¡¹ç›®',
                            description: description || 'æš‚æ— æè¿°'
                        });
                    }
                });
                
                // å¦‚æœæ²¡æœ‰ä»»ä½•é¡¹ç›®ï¼Œè¿”å›é»˜è®¤é¡¹ç›®
                return projects.length > 0 ? projects : [{
                    title: "ä¸»è¦æ´»è·ƒå¹³å°",
                    description: "æš‚æ— å¹³å°ä¿¡æ¯"
                }];
            }
            
            // ç”¨é¡¹ç›®æ•°æ®å¡«å……è¾“å…¥æ¡†
            function populateProjectsInputs(projects) {
                const container = document.getElementById('projectsContainer');
                if (!container) return;
                
                container.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹
                
                projects.forEach((project, index) => {
                    const group = document.createElement('div');
                    group.className = 'project-input-group';
                    
                    const removeButton = index === 0 ? '' : '<button type="button" class="btn btn-secondary remove-project" onclick="removeProjectInput(this)" style="position: absolute; top: 10px; right: 10px; padding: 5px 10px; font-size: 12px;">åˆ é™¤</button>';
                    
                    group.innerHTML = `
                        <input type="text" class="project-title" placeholder="æ ‡é¢˜" 
                               value="${escapeHtml(project.title)}" style="margin-bottom: 8px; width: 100%; box-sizing: border-box;">
                        <textarea class="project-description" placeholder="å†…å®¹æè¿°" 
                                  style="height: 80px; margin-bottom: 10px; width: 100%; box-sizing: border-box; resize: vertical;">${escapeHtml(project.description)}</textarea>
                        ${removeButton}
                    `;
                    
                    container.appendChild(group);
                });
            }
            
            // HTMLè½¬ä¹‰å‡½æ•°ï¼Œé˜²æ­¢XSS
            function escapeHtml(unsafe) {
                return unsafe
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }

            // å°†æ–‡æœ¬ä¸­çš„ç½‘å€è½¬æ¢ä¸ºå¯ç‚¹å‡»é“¾æ¥
            function autoLink(text) {
                if (!text) return '';
                
                // åŒ¹é… http/https/ftp å¼€å¤´çš„ç½‘å€
                const urlRegex = /(https?:\/\/[^\s]+)/g;
                
                return text.replace(urlRegex, function(url) {
                    return '<a href="' + url + '" target="_blank" style="color: #667eea; text-decoration: underline;">' + url + '</a >';
                });
            }

        // ç”¨æ•°æ®æ›´æ–°é¡µé¢
        function updatePageWithData(data) {
            // æ›´æ–°é¡µé¢æ˜¾ç¤º
            document.getElementById('displayName').textContent = data.name;
            document.getElementById('displayTagline').textContent = data.tagline;
            document.getElementById('displayAbout').textContent = data.about;
            document.getElementById('displayEducation').innerHTML = `<strong>${data.education.split(' - ')[0]}</strong> - ${data.education.split(' - ')[1]}`;
            
            // æ›´æ–°æŠ€èƒ½
            const skillsContainer = document.getElementById('displaySkills');
            skillsContainer.innerHTML = '';
            data.skills.forEach(skill => {
                const skillElement = document.createElement('div');
                skillElement.className = 'skill';
                skillElement.textContent = skill;
                skillsContainer.appendChild(skillElement);
            });
            
            // æ›´æ–°é¡¹ç›®
            const projectsContainer = document.getElementById('displayProjects');
            projectsContainer.innerHTML = '';
            data.projects.forEach(project => {
                const projectElement = document.createElement('div');
                projectElement.style.marginBottom = '20px';
                projectElement.style.padding = '15px';
                projectElement.style.background = 'white';
                projectElement.style.borderRadius = '8px';
                projectElement.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';
                
                // å¤„ç†æè¿°ä¸­çš„é“¾æ¥
                const descriptionHtml = autoLink(project.description);
                
                projectElement.innerHTML = `
                    <h3 style="margin-top: 0; color: #667eea;">${project.title}</h3>
                    <p style="margin-bottom: 0; white-space: pre-line;">${descriptionHtml}</p >
                `;
                projectsContainer.appendChild(projectElement);
            });
            
            // æ›´æ–°è”ç³»æ–¹å¼
            const contactContainer = document.getElementById('displayContact');
            contactContainer.innerHTML = '';
            data.contact.forEach(contact => {
                const contactElement = document.createElement('p');
                contactElement.textContent = contact;
                contactContainer.appendChild(contactElement);
            });
            
            // æ›´æ–°å¤´åƒ
            updateAvatarDisplay(data.avatar);
            
            // å¡«å……ç¼–è¾‘è¡¨å•
            document.getElementById('editName').value = data.name;
            document.getElementById('editTagline').value = data.tagline;
            document.getElementById('editAbout').value = data.about;
            document.getElementById('editEducation').value = data.education;
            document.getElementById('editSkills').value = data.skills.join(', ');
            populateProjectsInputs(data.projects); // ä½¿ç”¨æ–°çš„å¡«å……å‡½æ•°
            document.getElementById('editContact').value = data.contact.join('\n');
            // æ·»åŠ æ ‡é¢˜å­—æ®µå¡«å……
            document.getElementById('editActiveTitle').value = data.activeTitle || "";
            document.getElementById('editInactiveTitle').value = data.inactiveTitle || "";
            // ä¿å­˜å½“å‰æ•°æ®åˆ°å…¨å±€å˜é‡ï¼Œä¾›æ ‡é¢˜åˆ‡æ¢ä½¿ç”¨
            window.currentData = data;
            
            // è®¾ç½®åˆå§‹æ ‡é¢˜
            document.title = data.activeTitle || "RB/Tisir_Rçš„ä¸ªäººç½‘é¡µ";
        }

        // æ›´æ–°å¤´åƒæ˜¾ç¤º - ä¿®å¤ç‰ˆæœ¬
        function updateAvatarDisplay(avatarData) {
            const avatarDisplay = document.getElementById('avatarDisplay');
            const avatarPreview = document.getElementById('avatarPreview');

            // ä¿å­˜å¤´åƒæ•°æ®åˆ°å…¨å±€å˜é‡
            window.currentAvatar = avatarData;
    
            console.log('updateAvatarDisplay è¢«è°ƒç”¨ï¼Œæ•°æ®é•¿åº¦:', avatarData ? avatarData.length : 0);
            
            // æ¸…ç©ºç°æœ‰å†…å®¹
            avatarDisplay.innerHTML = '';
            
            // æ£€æŸ¥æ•°æ®æœ‰æ•ˆæ€§
            if (!avatarData || 
                avatarData === 'null' || 
                avatarData === 'NULL' || 
                avatarData === '' ||
                typeof avatarData !== 'string') {
                console.log('å¤´åƒæ•°æ®ä¸ºç©ºæˆ–æ— æ•ˆï¼Œæ˜¾ç¤ºé»˜è®¤å¤´åƒ');
                showDefaultAvatar(avatarDisplay, avatarPreview);
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯ HTML ä»£ç ï¼ˆé”™è¯¯æƒ…å†µï¼‰
            if (avatarData.includes('<img') || avatarData.includes('style=') || avatarData.includes('alt=')) {
                console.error('âŒ é”™è¯¯ï¼šå¤´åƒæ•°æ®åŒ…å« HTML ä»£ç ');
                showDefaultAvatar(avatarDisplay, avatarPreview);
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯æœ‰æ•ˆçš„ Base64 å›¾ç‰‡æ•°æ®
            if (avatarData.startsWith('data:image')) {
                console.log('âœ… æ˜¾ç¤ºæœ‰æ•ˆçš„ Base64 å¤´åƒ');
                
                // åˆ›å»º img å…ƒç´ 
                const img = document.createElement('img');
                img.src = avatarData;
                img.alt = 'ä¸ªäººå¤´åƒ';
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'cover';
                img.style.borderRadius = '50%';
                
                // ç›´æ¥æ·»åŠ åˆ° DOM
                avatarDisplay.appendChild(img);
                
                if (avatarPreview) {
                    avatarPreview.src = avatarData;
                }
            } else {
                console.log('â„¹ï¸ ä½¿ç”¨é»˜è®¤å¤´åƒï¼Œæ•°æ®æ ¼å¼ä¸æ”¯æŒ');
                showDefaultAvatar(avatarDisplay, avatarPreview);
            }
        }

        // æ˜¾ç¤ºé»˜è®¤å¤´åƒçš„è¾…åŠ©å‡½æ•°
        function showDefaultAvatar(avatarDisplay, avatarPreview) {
            avatarDisplay.innerHTML = `
                <div style="width:100%;height:100%;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;border-radius:50%;">
                    å¤´åƒ
                </div>
            `;
            if (avatarPreview) {
                avatarPreview.src = '';
            }
        }

        // æ‰“å¼€å¤´åƒç¼–è¾‘æ¨¡æ€æ¡†
        function openAvatarModal() {
            document.getElementById('avatarModal').style.display = 'flex';
            
            // è®¾ç½®æ–‡ä»¶é€‰æ‹©äº‹ä»¶
            document.getElementById('avatarUpload').addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                if (!file.type.match('image.*')) {
                    showStatus('avatarStatus', 'è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶!', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('avatarPreview').src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        // å…³é—­å¤´åƒç¼–è¾‘æ¨¡æ€æ¡†
        function closeAvatarModal() {
            document.getElementById('avatarModal').style.display = 'none';
            document.getElementById('avatarUpload').value = '';
            hideStatus('avatarStatus');
        }

        // ä¼˜åŒ–ç‰ˆä¸Šä¼ å¤´åƒ - ä¸åœ¨æœ¬åœ°å­˜å‚¨ Base64 æ•°æ®
        async function uploadAvatar() {
            const fileInput = document.getElementById('avatarUpload');
            if (!fileInput.files[0]) {
                showStatus('avatarStatus', 'è¯·å…ˆé€‰æ‹©å›¾ç‰‡æ–‡ä»¶!', 'error');
                return;
            }
            
            // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶åœ¨ 1MB ä»¥å†…ï¼‰
            const file = fileInput.files[0];
            if (file.size > 1024 * 1024) {
                showStatus('avatarStatus', 'å›¾ç‰‡æ–‡ä»¶å¤ªå¤§ï¼Œè¯·é€‰æ‹©å°äº 1MB çš„å›¾ç‰‡!', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                const avatarData = e.target.result;
                
                console.log('å¤´åƒæ•°æ®å¤§å°:', avatarData.length, 'å­—ç¬¦');
                
                try {
                    // ç›´æ¥ä¿å­˜åˆ° Supabaseï¼Œä¸å…ˆæ›´æ–°æœ¬åœ°å­˜å‚¨
                    const { data: currentData, error: fetchError } = await window.supabase
                        .from('website_data')
                        .select('*')
                        .eq('id', 1)
                        .single();
                        
                    if (fetchError) throw fetchError;
                    
                    const updateData = {
                        ...currentData,
                        avatar: avatarData,
                        last_updated: new Date().toISOString()
                    };
                    
                    // ä¿å­˜åˆ° Supabase
                    const { error } = await window.supabase
                        .from('website_data')
                        .upsert(updateData);
                        
                    if (error) throw error;
                    
                    console.log('âœ… å¤´åƒå·²ä¿å­˜åˆ°Supabase');
                    
                    // æ›´æ–°é¡µé¢æ˜¾ç¤ºï¼Œä½†ä¸åœ¨æœ¬åœ°å­˜å‚¨ä¿å­˜ Base64 æ•°æ®
                    updateAvatarDisplay(avatarData);
                    document.getElementById('last_updated').textContent = new Date().toLocaleDateString('zh-CN');
                    
                    // æ›´æ–°æœ¬åœ°å­˜å‚¨ï¼Œä½†ä¸åŒ…å«å¤§å°ºå¯¸å¤´åƒæ•°æ®
                    const dataForLocalStorage = { ...updateData };
                    if (dataForLocalStorage.avatar) {
                        delete dataForLocalStorage.avatar; // ç¡®ä¿å¤§å¤´åƒçš„æ•°æ®ä¹Ÿä¼šæ˜¯å®Œæ•´çš„
                    }
                    localStorage.setItem('personalWebsiteData', JSON.stringify(dataForLocalStorage));
                    
                    showStatus('avatarStatus', 'å¤´åƒæ›´æ–°æˆåŠŸ!', 'success');
                    
                    // 1ç§’åå…³é—­æ¨¡æ€æ¡†
                    setTimeout(() => {
                        closeAvatarModal();
                    }, 1000);
                    
                } catch (error) {
                    console.error('ä¿å­˜å¤´åƒåˆ°æ•°æ®åº“å¤±è´¥:', error);
                    showStatus('avatarStatus', 'å¤´åƒä¿å­˜åˆ°äº‘ç«¯å¤±è´¥', 'error');
                }
            };
            reader.readAsDataURL(file);
        }

        // æ‰“å¼€å¯†ç éªŒè¯æ¨¡æ€æ¡†
        function openPasswordModal(type) {
            window.passwordFor = type || 'edit'; // é»˜è®¤ä¸ºç¼–è¾‘å†…å®¹
            document.getElementById('passwordModal').style.display = 'flex';
            document.getElementById('passwordInput').focus();
        }

        // å…³é—­å¯†ç éªŒè¯æ¨¡æ€æ¡†
        function closePasswordModal() {
           document.getElementById('passwordModal').style.display = 'none';
            document.getElementById('passwordInput').value = '';
            hideStatus('passwordStatus');
        }

        // éªŒè¯å¯†ç 
        function verifyPassword() {
           const password = document.getElementById('passwordInput').value;

            if (password === EDIT_PASSWORD) {
                closePasswordModal();
                // æ£€æŸ¥æ˜¯ç¼–è¾‘å†…å®¹è¿˜æ˜¯ç¼–è¾‘å¤´åƒ
                if (window.passwordFor === 'avatar') {
                    openAvatarModal();
                } else {
                    openEditModal();
                }
            } else {
                showStatus('passwordStatus', 'å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•!', 'error');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        // æ‰“å¼€å†…å®¹ç¼–è¾‘æ¨¡æ€æ¡†
        function openEditModal() {
            document.getElementById('editModal').style.display = 'flex';
            
            // ç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªé¡¹ç›®è¾“å…¥æ¡†
            const container = document.getElementById('projectsContainer');
            if (container && container.children.length === 0) {
                addProjectInput();
            }
        }

        // å…³é—­å†…å®¹ç¼–è¾‘æ¨¡æ€æ¡†
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            hideStatus('editStatus');
        }

        // ä¿å­˜æ‰€æœ‰æ›´æ”¹ - ä¼˜åŒ–ç‰ˆï¼ˆé¿å…å­˜å‚¨é…é¢è¶…é™ï¼‰
        async function saveChanges() {
            
                // è·å–è¡¨å•æ•°æ®
                const name = document.getElementById('editName').value;
                const tagline = document.getElementById('editTagline').value;
                const about = document.getElementById('editAbout').value;
                const education = document.getElementById('editEducation').value;
                const skills = document.getElementById('editSkills').value.split(',').map(s => s.trim()).filter(s => s);
                const projects = collectProjectsData(); // ä½¿ç”¨æ–°çš„æ”¶é›†å‡½æ•°
                const contact = document.getElementById('editContact').value.split('\n').filter(c => c.trim());
                // æ·»åŠ æ ‡é¢˜æ•°æ®
                const activeTitle = document.getElementById('editActiveTitle').value;
                const inactiveTitle = document.getElementById('editInactiveTitle').value;
                            
                // è·å–å½“å‰æ•°æ®ä½†ä¸åŒ…å«å¤§å°ºå¯¸çš„å¤´åƒ
                const savedData = localStorage.getItem('personalWebsiteData');
                const currentData = savedData ? JSON.parse(savedData) : defaultData;
                
                // åˆ›å»ºæ–°æ•°æ®å¯¹è±¡
                const newData = {
                    name,
                    tagline,
                    about,
                    education,
                    skills,
                    projects: projects.length > 0 ? projects : defaultData.projects,
                    contact: contact.length > 0 ? contact : defaultData.contact,
                    avatar: currentData.avatar, // ä¿ç•™ç°æœ‰çš„å¤´åƒæ•°æ®
                    // æ·»åŠ æ ‡é¢˜æ•°æ®
                    activeTitle: activeTitle || defaultData.activeTitle,
                    inactiveTitle: inactiveTitle || defaultData.inactiveTitle,
                    last_updated: new Date().toISOString() // åªä¿ç•™è¿™ä¸€ä¸ªæ—¶é—´æˆ³
                };
            
            try {
                // æ£€æŸ¥ Supabase æ˜¯å¦å¯ç”¨
                if (!window.supabase || typeof window.supabase.from !== 'function') {
                    throw new Error('Supabase å®¢æˆ·ç«¯ä¸å¯ç”¨');
                }
                
                // ä¿å­˜åˆ°Supabaseæ•°æ®åº“
                const { error } = await window.supabase
                    .from('website_data')
                    .upsert({ 
                        id: 1,
                        ...newData
                    });
                    
                if (error) throw error;
                
                console.log('æ•°æ®å·²ä¿å­˜åˆ°Supabase');
                
                // æ›´æ–°æœ¬åœ°å­˜å‚¨ï¼ŒåŒ…å«å®Œæ•´çš„å¤´åƒæ•°æ®
                const dataForLocalStorage = { ...newData };
                // ç¡®ä¿åŒ…å«å½“å‰çš„å¤´åƒæ•°æ®ï¼Œä¸é™åˆ¶å¤§å°
                if (window.currentAvatar) {
                    dataForLocalStorage.avatar = window.currentAvatar;
                }
                localStorage.setItem('personalWebsiteData', JSON.stringify(dataForLocalStorage));
                
                // æ›´æ–°é¡µé¢æ˜¾ç¤º
                updatePageWithData(newData);
                document.getElementById('last_updated').textContent = new Date().toLocaleDateString('zh-CN');
                
                showStatus('editStatus', 'æ•°æ®å·²ä¿å­˜åˆ°äº‘ç«¯ï¼', 'success');
                
                // 1ç§’åå…³é—­æ¨¡æ€æ¡†
                setTimeout(() => {
                    closeEditModal();
                }, 1000);
                
            } catch (error) {
                console.error('ä¿å­˜åˆ°æ•°æ®åº“å¤±è´¥:', error);
                // é™çº§åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('personalWebsiteData', JSON.stringify(newData));
                updatePageWithData(newData);
                document.getElementById('last_updated').textContent = new Date().toLocaleDateString('zh-CN');
                showStatus('editStatus', 'ä¿å­˜åˆ°äº‘ç«¯å¤±è´¥ï¼Œå·²ä¿å­˜åˆ°æœ¬åœ°', 'error');
            }
        }

            // æäº¤åé¦ˆåˆ°æ•°æ®åº“ - å¢å¼ºç‰ˆï¼ˆå¸¦è‡ªåŠ¨å…³é—­å’ŒæŒ‰é’®çŠ¶æ€ï¼‰
            async function submitFeedback() {
                const submitBtn = document.getElementById('feedbackSubmitBtn');
                const originalText = submitBtn.textContent;
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                submitBtn.textContent = 'æäº¤ä¸­...';
                submitBtn.disabled = true;
                
                const name = document.getElementById('feedbackName').value.trim();
                const email = document.getElementById('feedbackEmail').value.trim();
                const message = document.getElementById('feedbackMessage').value.trim();
                
                // éªŒè¯å¿…å¡«å­—æ®µ
                if (!message) {
                    showStatus('feedbackStatus', 'è¯·å¡«å†™åé¦ˆå†…å®¹!', 'error');
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                    // 3ç§’åè‡ªåŠ¨å…³é—­é”™è¯¯æç¤º
                    setTimeout(() => {
                        hideStatus('feedbackStatus');
                    }, 3000);
                    return;
                }
                
                try {
                    // ä¿å­˜åˆ° Supabase
                    const { error } = await window.supabase
                        .from('feedback')
                        .insert([
                            {
                                name: name || 'åŒ¿åç”¨æˆ·',
                                email: email || '',
                                message: message
                            }
                        ]);
                        
                    if (error) throw error;
                    
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('feedbackName').value = '';
                    document.getElementById('feedbackEmail').value = '';
                    document.getElementById('feedbackMessage').value = '';
                    
                    showStatus('feedbackStatus', 'æˆ‘æ™šç‚¹å°±å»Supabaseä¸Šåº·åº·ğŸ˜‹', 'success');
                    loadFeedbackStats();
                    
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                    
                    // 3ç§’åè‡ªåŠ¨å…³é—­æˆåŠŸæç¤º
                    setTimeout(() => {
                        hideStatus('feedbackStatus');
                    }, 3000);
                    
                } catch (error) {
                    console.error('æäº¤åé¦ˆå¤±è´¥:', error);
                    showStatus('feedbackStatus', 'æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•!', 'error');
                    
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                    
                    // 3ç§’åè‡ªåŠ¨å…³é—­é”™è¯¯æç¤º
                    setTimeout(() => {
                        hideStatus('feedbackStatus');
                    }, 3000);
                }
            }

            // åé¦ˆç®¡ç†åŠŸèƒ½
            let currentFeedbackFilter = 'all';
            
            // åŠ è½½åé¦ˆç»Ÿè®¡
            async function loadFeedbackStats() {
                try {
                    if (!window.supabase) {
                        throw new Error('Supabase ä¸å¯ç”¨');
                    }
            
                    // è·å–å¾…å¤„ç†åé¦ˆæ•°é‡
                    const { data: pendingData, error: pendingError } = await window.supabase
                        .from('feedback')
                        .select('id', { count: 'exact' })
                        .eq('status', 'pending');
            
                    if (pendingError) throw pendingError;
            
                    // è·å–å·²å¤„ç†åé¦ˆæ•°é‡
                    const { data: processedData, error: processedError } = await window.supabase
                        .from('feedback')
                        .select('id', { count: 'exact' })
                        .eq('status', 'processed');
            
                    if (processedError) throw processedError;
            
                    // è·å–æ€»åé¦ˆæ•°é‡
                    const { data: totalData, error: totalError } = await window.supabase
                        .from('feedback')
                        .select('id', { count: 'exact' });
            
                    if (totalError) throw totalError;
            
                    // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
                    document.getElementById('pendingCount').textContent = pendingData.length || 0;
                    document.getElementById('processedCount').textContent = processedData.length || 0;
                    document.getElementById('totalCount').textContent = totalData.length || 0;
            
                } catch (error) {
                    console.error('åŠ è½½åé¦ˆç»Ÿè®¡å¤±è´¥:', error);
                }
            }
            
            // åŠ è½½åé¦ˆåˆ—è¡¨
            async function loadFeedback() {
                try {
                    if (!window.supabase) {
                        throw new Error('Supabase ä¸å¯ç”¨');
                    }
            
                    let query = window.supabase
                        .from('feedback')
                        .select('*')
                        .order('created_at', { ascending: false });
            
                    // åº”ç”¨è¿‡æ»¤å™¨
                    if (currentFeedbackFilter === 'pending') {
                        query = query.eq('status', 'pending');
                    }
            
                    const { data: feedbacks, error } = await query;
            
                    if (error) throw error;
            
                    displayFeedbackList(feedbacks || []);
            
                } catch (error) {
                    console.error('åŠ è½½åé¦ˆåˆ—è¡¨å¤±è´¥:', error);
                    document.getElementById('feedbackList').innerHTML = '<p style="text-align: center; color: #d32f2f;">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</p >';
                }
            }
            
            // æ˜¾ç¤ºåé¦ˆåˆ—è¡¨
            function displayFeedbackList(feedbacks) {
                const container = document.getElementById('feedbackList');
                
                if (feedbacks.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #666;">æš‚æ— åé¦ˆ</p >';
                    return;
                }
            
                let html = '';
                feedbacks.forEach(feedback => {
                    const date = new Date(feedback.created_at).toLocaleString('zh-CN');
                    const statusClass = feedback.status === 'processed' ? 'feedback-item-processed' : 'feedback-item-pending';
                    const statusText = feedback.status === 'processed' ? 'å·²å¤„ç†' : 'å¾…å¤„ç†';
                    
                    html += `
                        <div class="feedback-item ${statusClass}" style="
                            background: white; 
                            padding: 15px; 
                            margin-bottom: 10px; 
                            border-radius: 8px; 
                            border-left: 4px solid ${feedback.status === 'processed' ? '#4caf50' : '#ff9800'};
                            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                        ">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                <div>
                                    <strong>${feedback.name || 'åŒ¿åç”¨æˆ·'}</strong>
                                    ${feedback.email ? `<span style="color: #666; margin-left: 10px;">${feedback.email}</span>` : ''}
                                </div>
                                <div style="display: flex; gap: 5px; align-items: center;">
                                    <span class="feedback-status" style="
                                        background: ${feedback.status === 'processed' ? '#e8f5e8' : '#fff3e0'};
                                        color: ${feedback.status === 'processed' ? '#2e7d32' : '#ef6c00'};
                                        padding: 2px 8px;
                                        border-radius: 12px;
                                        font-size: 0.8em;
                                    ">${statusText}</span>
                                    <span style="color: #999; font-size: 0.9em;">${date}</span>
                                </div>
                            </div>
                            <div style="color: #333; line-height: 1.5; margin-bottom: 10px;">${feedback.message}</div>
                            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                ${feedback.status === 'pending' ? `
                                    <button class="btn" onclick="markAsProcessed(${feedback.id})" style="padding: 5px 10px; font-size: 0.8em;">æ ‡è®°ä¸ºå·²å¤„ç†</button>
                                ` : `
                                    <button class="btn btn-secondary" onclick="markAsPending(${feedback.id})" style="padding: 5px 10px; font-size: 0.8em;">æ ‡è®°ä¸ºå¾…å¤„ç†</button>
                                `}
                                <button class="btn btn-secondary" onclick="deleteFeedback(${feedback.id})" style="padding: 5px 10px; font-size: 0.8em; background: #f44336;">åˆ é™¤</button>
                            </div>
                        </div>
                    `;
                });
            
                container.innerHTML = html;
            }
            
            // æ ‡è®°åé¦ˆä¸ºå·²å¤„ç†
            async function markAsProcessed(feedbackId) {
                if (!confirm('ç¡®å®šæ ‡è®°ä¸ºå·²å¤„ç†å—ï¼Ÿ')) return;
            
                try {
                    const { error } = await window.supabase
                        .from('feedback')
                        .update({ 
                            status: 'processed',
                            processed_at: new Date().toISOString()
                        })
                        .eq('id', feedbackId);
            
                    if (error) throw error;
            
                    // é‡æ–°åŠ è½½ç»Ÿè®¡å’Œåˆ—è¡¨
                    loadFeedbackStats();
                    loadFeedback();
                    
                    alert('åé¦ˆå·²æ ‡è®°ä¸ºå·²å¤„ç†');
            
                } catch (error) {
                    console.error('æ ‡è®°åé¦ˆå¤±è´¥:', error);
                    alert('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            }
            
            // æ ‡è®°åé¦ˆä¸ºå¾…å¤„ç†
            async function markAsPending(feedbackId) {
                if (!confirm('ç¡®å®šæ ‡è®°ä¸ºå¾…å¤„ç†å—ï¼Ÿ')) return;
            
                try {
                    const { error } = await window.supabase
                        .from('feedback')
                        .update({ 
                            status: 'pending',
                            processed_at: null
                        })
                        .eq('id', feedbackId);
            
                    if (error) throw error;
            
                    // é‡æ–°åŠ è½½ç»Ÿè®¡å’Œåˆ—è¡¨
                    loadFeedbackStats();
                    loadFeedback();
                    
                    alert('åé¦ˆå·²æ ‡è®°ä¸ºå¾…å¤„ç†');
            
                } catch (error) {
                    console.error('æ ‡è®°åé¦ˆå¤±è´¥:', error);
                    alert('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            }
            
            // åˆ é™¤åé¦ˆ
            async function deleteFeedback(feedbackId) {
                if (!confirm('ç¡®å®šåˆ é™¤è¿™æ¡åé¦ˆå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) return;
            
                try {
                    const { error } = await window.supabase
                        .from('feedback')
                        .delete()
                        .eq('id', feedbackId);
            
                    if (error) throw error;
            
                    // é‡æ–°åŠ è½½ç»Ÿè®¡å’Œåˆ—è¡¨
                    loadFeedbackStats();
                    loadFeedback();
                    
                    alert('åé¦ˆå·²åˆ é™¤');
            
                } catch (error) {
                    console.error('åˆ é™¤åé¦ˆå¤±è´¥:', error);
                    alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            }
            
            // è¿‡æ»¤åŠŸèƒ½
            function showOnlyPending() {
                currentFeedbackFilter = 'pending';
                loadFeedback();
            }
            
            function showAllFeedback() {
                currentFeedbackFilter = 'all';
                loadFeedback();
            }
        
        
        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status-message status-${type}`;
            element.style.display = 'block';
        }

        // éšè—çŠ¶æ€æ¶ˆæ¯
        function hideStatus(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.addEventListener('click', function(event) {
            if (event.target === document.getElementById('avatarModal')) {
                closeAvatarModal();
            }
            if (event.target === document.getElementById('editModal')) {
                closeEditModal();
            }
            if (event.target === document.getElementById('passwordModal')) {
                closePasswordModal();
            }
        });
    </script>

        <!-- è®¿å®¢è®¡æ•°å™¨ -->
        <div class="visitor-counter">
            <div style="text-align: center;">
                <div style="margin-bottom: 5px;">
                    <span style="font-size: 0.8em;">ğŸ“Š æ€»è®¿é—®æ¬¡æ•°:</span>
                    <span id="totalVisits" style="font-weight: bold;">0</span>
                </div>
                <div>
                    <span style="font-size: 0.8em;">ğŸ‘¥ ç‹¬ç«‹è®¿å®¢:</span>
                    <span id="uniqueVisitors" style="font-weight: bold;">0</span>
                </div>
            </div>
        </div>

</body></html>
